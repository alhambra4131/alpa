const a124_0x4f10=['permissionsFor','title','handleReactionAnnouncement','author','default','users','catch','channels','exclusive','Rejected','color','filter','findById','user','footer','GREEN','height','roles','messageReactionAdd','../models/ReactionRoleGroup','RED','LISTENER_MODE','reactions','map','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','includes','permissions','url','INDIGO','remove','MANAGE_MESSAGES','handleReactionRoles','guild','suggestionsChannelId','test','return\x20/\x22\x20+\x20this\x20+\x20\x22/','../utils/emojis','exec','partial','emoji','../models/Role','handleSuggestions','findOne','embeds','values','Suggestion\x20','handleStarboard','MANAGE_GUILD','message','fetch','COLORS','starboardChannelId','Starboard','name','Accepted','parseEmoji','content','compile','size','handleReactionPinning','Suggestion','cache','has','attachments','Listener','first','displayAvatarURL','channel','length','announcementsChannelId','get','send','apply','member','value','Constants','exports','text','\x20announced\x20via\x20Announcement\x20Pinnning.'];(function(_0x567493,_0x4f101b){const _0x2ba03d=function(_0x318871){while(--_0x318871){_0x567493['push'](_0x567493['shift']());}};const _0x33e88d=function(){const _0x2b5136={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0xbcdbad,_0x37798a,_0x7beb9b,_0x52a509){_0x52a509=_0x52a509||{};let _0x23e671=_0x37798a+'='+_0x7beb9b;let _0x446cc9=0x0;for(let _0x1e9730=0x0,_0x11832d=_0xbcdbad['length'];_0x1e9730<_0x11832d;_0x1e9730++){const _0x373fbd=_0xbcdbad[_0x1e9730];_0x23e671+=';\x20'+_0x373fbd;const _0x2bac98=_0xbcdbad[_0x373fbd];_0xbcdbad['push'](_0x2bac98);_0x11832d=_0xbcdbad['length'];if(_0x2bac98!==!![]){_0x23e671+='='+_0x2bac98;}}_0x52a509['cookie']=_0x23e671;},'removeCookie':function(){return'dev';},'getCookie':function(_0x5311a6,_0x3f0c60){_0x5311a6=_0x5311a6||function(_0x173aa1){return _0x173aa1;};const _0x345b3c=_0x5311a6(new RegExp('(?:^|;\x20)'+_0x3f0c60['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));const _0xcf2c3=function(_0x2414a8,_0x556108){_0x2414a8(++_0x556108);};_0xcf2c3(_0x2ba03d,_0x4f101b);return _0x345b3c?decodeURIComponent(_0x345b3c[0x1]):undefined;}};const _0x442480=function(){const _0x38a8c8=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x38a8c8['test'](_0x2b5136['removeCookie']['toString']());};_0x2b5136['updateCookie']=_0x442480;let _0x54931f='';const _0x41b6bc=_0x2b5136['updateCookie']();if(!_0x41b6bc){_0x2b5136['setCookie'](['*'],'counter',0x1);}else if(_0x41b6bc){_0x54931f=_0x2b5136['getCookie'](null,'counter');}else{_0x2b5136['removeCookie']();}};_0x33e88d();}(a124_0x4f10,0x1cf));const a124_0x2ba0=function(_0x567493,_0x4f101b){_0x567493=_0x567493-0x0;let _0x2ba03d=a124_0x4f10[_0x567493];return _0x2ba03d;};const a124_0x2b5136=function(){let _0x14b63a=!![];return function(_0xf62d88,_0x350b26){const _0x302c08=_0x14b63a?function(){if(_0x350b26){const _0x2f8308=_0x350b26[a124_0x2ba0('0x4')](_0xf62d88,arguments);_0x350b26=null;return _0x2f8308;}}:function(){};_0x14b63a=![];return _0x302c08;};}();const a124_0x318871=a124_0x2b5136(this,function(){const _0x208796=function(){const _0x2c89a3=_0x208796['constructor'](a124_0x2ba0('0x2e'))()[a124_0x2ba0('0x44')](a124_0x2ba0('0x23'));return!_0x2c89a3[a124_0x2ba0('0x2d')](a124_0x318871);};return _0x208796();});a124_0x318871();'use strict';const tesseract_1=require('tesseract');const ReactionRoleGroup_1=require(a124_0x2ba0('0x1e'));const Role_1=require(a124_0x2ba0('0x33'));const emojis=require(a124_0x2ba0('0x2f'));module[a124_0x2ba0('0x8')]=class MessageReactionAddListener extends tesseract_1[a124_0x2ba0('0x4b')]{constructor(){super(a124_0x2ba0('0x1d'),{'mode':tesseract_1['Constants'][a124_0x2ba0('0x20')]['ON']});this[a124_0x2ba0('0x34')]=async(_0x3831c7,_0x5b55c5)=>{if(!['‚úÖ','‚ùé'][a124_0x2ba0('0x24')](_0x3831c7[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')]))return;if(!_0x3831c7['message'][a124_0x2ba0('0x4e')][a124_0x2ba0('0xb')](_0x5b55c5)['has']('MANAGE_CHANNELS'))return;const _0x7345fa=_0x3831c7['message'];const _0x3584f6=_0x7345fa[a124_0x2ba0('0x36')][0x0];if(!_0x3584f6)return;if(!_0x3584f6[a124_0x2ba0('0xc')]['startsWith'](a124_0x2ba0('0x47')))return;_0x3584f6[a124_0x2ba0('0x15')]=_0x3831c7[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')]==='‚úÖ'?tesseract_1[a124_0x2ba0('0x7')][a124_0x2ba0('0x3d')][a124_0x2ba0('0x1a')]:_0x3831c7['emoji'][a124_0x2ba0('0x40')]==='‚ùé'?tesseract_1['Constants'][a124_0x2ba0('0x3d')][a124_0x2ba0('0x1f')]:tesseract_1[a124_0x2ba0('0x7')][a124_0x2ba0('0x3d')][a124_0x2ba0('0x27')];_0x3584f6['title']=a124_0x2ba0('0x38')+(_0x3831c7[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')]==='‚úÖ'?a124_0x2ba0('0x41'):_0x3831c7[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')]==='‚ùé'?a124_0x2ba0('0x14'):'');await _0x7345fa['edit']({'embed':_0x3584f6});};this[a124_0x2ba0('0x39')]=async(_0x2f4c73,_0x40fdaf,_0x2ede40)=>{if(!['üå†','üåü','‚≠ê'][a124_0x2ba0('0x24')](_0x2f4c73[a124_0x2ba0('0x32')]['name']))return;if(_0x40fdaf[a124_0x2ba0('0x1c')][a124_0x2ba0('0x48')][a124_0x2ba0('0x45')]<=0x1)return;if(_0x2f4c73[a124_0x2ba0('0x3b')][a124_0x2ba0('0xe')]['id']===_0x40fdaf[a124_0x2ba0('0x18')]['id'])return;const _0x572a7a=_0x2f4c73[a124_0x2ba0('0x3b')][a124_0x2ba0('0x4a')][a124_0x2ba0('0x16')](_0x410758=>Boolean(_0x410758[a124_0x2ba0('0x1b')]&&_0x410758['width']));const _0x5bfc55=_0x572a7a[a124_0x2ba0('0x4c')]();if(!_0x2f4c73[a124_0x2ba0('0x3b')]['content']&&!_0x5bfc55)return;await _0x2ede40[a124_0x2ba0('0x3')]({'embed':{'color':tesseract_1[a124_0x2ba0('0x7')][a124_0x2ba0('0x3d')]['YELLOW'],'author':{'name':_0x2f4c73['message'][a124_0x2ba0('0xe')]['tag'],'iconURL':_0x2f4c73['message'][a124_0x2ba0('0xe')][a124_0x2ba0('0x4d')]({'dynamic':!![],'size':0x40})},'description':_0x2f4c73['message'][a124_0x2ba0('0x43')],'fields':[{'name':'Source','value':'[Click\x20here\x20to\x20Jump\x20to\x20the\x20Message.]('+_0x2f4c73['message'][a124_0x2ba0('0x26')]+')','inline':!![]}],'image':{'url':_0x5bfc55?_0x5bfc55[a124_0x2ba0('0x26')]:null},'footer':{'text':a124_0x2ba0('0x3f')}}});};this['handleReactionAnnouncement']=async(_0x308e19,_0x4fd400,_0x4ab84e)=>{if(!['üì£','üì¢']['includes'](_0x308e19[a124_0x2ba0('0x32')]['name']))return;if(!_0x4fd400[a124_0x2ba0('0x25')][a124_0x2ba0('0x49')](a124_0x2ba0('0x3a')))return;const _0x14c77e=_0x4fd400['user']['tag']+a124_0x2ba0('0xa');const _0x228e1a=_0x308e19[a124_0x2ba0('0x3b')]['embeds']&&_0x308e19[a124_0x2ba0('0x3b')][a124_0x2ba0('0x36')][a124_0x2ba0('0x0')]?_0x308e19[a124_0x2ba0('0x3b')]['embeds'][0x0]:{};_0x228e1a[a124_0x2ba0('0x19')]={..._0x228e1a[a124_0x2ba0('0x19')],'text':_0x228e1a[a124_0x2ba0('0x19')]&&_0x228e1a[a124_0x2ba0('0x19')][a124_0x2ba0('0x9')]?_0x14c77e+'\x20‚Ä¢\x20'+_0x228e1a[a124_0x2ba0('0x19')][a124_0x2ba0('0x9')]:_0x14c77e};await _0x4ab84e[a124_0x2ba0('0x3')](_0x308e19[a124_0x2ba0('0x3b')][a124_0x2ba0('0x43')],{'embed':_0x228e1a,'files':[..._0x308e19[a124_0x2ba0('0x3b')][a124_0x2ba0('0x4a')][a124_0x2ba0('0x37')]()]});};this[a124_0x2ba0('0x46')]=async(_0x2796b5,_0x17fa09)=>{if(!['üìå','üìç'][a124_0x2ba0('0x24')](_0x2796b5[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')]))return;if(!_0x2796b5['message'][a124_0x2ba0('0x4e')][a124_0x2ba0('0xb')](_0x17fa09)['has'](a124_0x2ba0('0x29')))return;await _0x2796b5[a124_0x2ba0('0x3b')]['pin']();};this[a124_0x2ba0('0x2a')]=async(_0x200ce2,_0x138469)=>{const _0xb1b4f1=await ReactionRoleGroup_1[a124_0x2ba0('0xf')][a124_0x2ba0('0x17')](_0x200ce2[a124_0x2ba0('0x3b')]['id']);if(!_0xb1b4f1)return;const _0x2e77c7=_0x200ce2[a124_0x2ba0('0x32')]['id']?'<'+(_0x200ce2[a124_0x2ba0('0x32')]['animated']?'a':'')+':'+_0x200ce2['emoji']['name']+':'+_0x200ce2[a124_0x2ba0('0x32')]['id']+'>':_0x200ce2['emoji']['name'];const _0xc7a58a=emojis[a124_0x2ba0('0x42')](_0x2e77c7);if(_0xc7a58a){const _0x5eab06=await Role_1[a124_0x2ba0('0xf')][a124_0x2ba0('0x35')]({'$or':_0xb1b4f1['roles'][a124_0x2ba0('0x22')](_0x23967b=>({'_id':_0x23967b})),'guild':_0x200ce2[a124_0x2ba0('0x3b')]['guild']['id'],'emoji':_0xc7a58a[a124_0x2ba0('0x6')]});if(!_0x5eab06)return;if(_0xb1b4f1[a124_0x2ba0('0x13')]){for(const _0x2c16e2 of _0x200ce2['message'][a124_0x2ba0('0x21')][a124_0x2ba0('0x48')]['filter'](_0x3047b1=>_0x3047b1[a124_0x2ba0('0x10')][a124_0x2ba0('0x48')][a124_0x2ba0('0x49')](_0x138469[a124_0x2ba0('0x18')]['id'])&&_0x3047b1[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')]!==_0x200ce2[a124_0x2ba0('0x32')][a124_0x2ba0('0x40')])[a124_0x2ba0('0x37')]()){await _0x2c16e2[a124_0x2ba0('0x10')]['remove'](_0x138469)[a124_0x2ba0('0x11')](()=>{});}await _0x138469['roles'][a124_0x2ba0('0x28')](_0xb1b4f1[a124_0x2ba0('0x1c')],'Auto\x20Removed\x20via\x20Reaction\x20Roles');}await _0x138469[a124_0x2ba0('0x1c')]['add'](_0x5eab06['_id'],'Added\x20via\x20Reaction\x20Roles');}};this[a124_0x2ba0('0x30')]=async(_0x16c688,_0x322fb6)=>{if(_0x16c688[a124_0x2ba0('0x31')]){_0x16c688=await _0x16c688[a124_0x2ba0('0x3c')]();}if(_0x16c688[a124_0x2ba0('0x3b')]['partial']){_0x16c688['message']=await _0x16c688[a124_0x2ba0('0x3b')][a124_0x2ba0('0x3c')]();}if(!_0x16c688[a124_0x2ba0('0x3b')][a124_0x2ba0('0x2b')])return;const _0x4856bc=_0x16c688['message'][a124_0x2ba0('0x2b')][a124_0x2ba0('0x5')](_0x322fb6);this[a124_0x2ba0('0x2a')](_0x16c688,_0x4856bc)[a124_0x2ba0('0x11')](()=>{});const _0x36fe1a=await _0x16c688['message'][a124_0x2ba0('0x2b')]['getDocument']();if(_0x36fe1a[a124_0x2ba0('0x2c')]&&_0x16c688[a124_0x2ba0('0x3b')]['channel']['id']===_0x36fe1a[a124_0x2ba0('0x2c')]){this[a124_0x2ba0('0x34')](_0x16c688,_0x4856bc)[a124_0x2ba0('0x11')](()=>{});}if(_0x36fe1a['starboardChannelId']&&_0x16c688['message'][a124_0x2ba0('0x2b')][a124_0x2ba0('0x12')][a124_0x2ba0('0x48')][a124_0x2ba0('0x49')](_0x36fe1a[a124_0x2ba0('0x3e')])){this[a124_0x2ba0('0x39')](_0x16c688,_0x4856bc,_0x16c688[a124_0x2ba0('0x3b')]['guild']['channels'][a124_0x2ba0('0x48')][a124_0x2ba0('0x2')](_0x36fe1a[a124_0x2ba0('0x3e')]))[a124_0x2ba0('0x11')](()=>{});}if(_0x36fe1a['reactionAnnouncements']&&_0x16c688[a124_0x2ba0('0x3b')]['guild']['channels'][a124_0x2ba0('0x48')][a124_0x2ba0('0x49')](_0x36fe1a[a124_0x2ba0('0x1')])){this[a124_0x2ba0('0xd')](_0x16c688,_0x4856bc,_0x16c688[a124_0x2ba0('0x3b')][a124_0x2ba0('0x2b')][a124_0x2ba0('0x12')][a124_0x2ba0('0x48')][a124_0x2ba0('0x2')](_0x36fe1a[a124_0x2ba0('0x1')]))[a124_0x2ba0('0x11')](()=>{});}if(_0x36fe1a['reactionPinning']){this['handleReactionPinning'](_0x16c688,_0x4856bc)[a124_0x2ba0('0x11')](()=>{});}};}};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2VSZWFjdGlvbkFkZC5qcyJdLCJuYW1lcyI6WyJ0ZXNzZXJhY3RfMSIsInJlcXVpcmUiLCJSZWFjdGlvblJvbGVHcm91cF8xIiwiUm9sZV8xIiwiZW1vamlzIiwibW9kdWxlIiwiTWVzc2FnZVJlYWN0aW9uQWRkTGlzdGVuZXIiLCJjb25zdHJ1Y3RvciIsIl8weDM4MzFjNyIsIl8weDViNTVjNSIsIl8weDczNDVmYSIsIl8weDM1ODRmNiIsIl8weDJmNGM3MyIsIl8weDQwZmRhZiIsIl8weDJlZGU0MCIsIl8weDU3MmE3YSIsIl8weDQxMDc1OCIsIkJvb2xlYW4iLCJfMHg1YmZjNTUiLCJfMHgzMDhlMTkiLCJfMHg0ZmQ0MDAiLCJfMHg0YWI4NGUiLCJfMHgxNGM3N2UiLCJfMHgyMjhlMWEiLCJfMHgyNzk2YjUiLCJfMHgxN2ZhMDkiLCJfMHgyMDBjZTIiLCJfMHgxMzg0NjkiLCJfMHhiMWI0ZjEiLCJfMHgyZTc3YzciLCJfMHhjN2E1OGEiLCJfMHg1ZWFiMDYiLCJfMHgyMzk2N2IiLCJfMHgyYzE2ZTIiLCJfMHgzMDQ3YjEiLCJfMHgxNmM2ODgiLCJfMHgzMjJmYjYiLCJfMHg0ODU2YmMiLCJfMHgzNmZlMWEiXSwibWFwcGluZ3MiOiJteEdBQUEsYUFLQSxNQUFNQSxXQUFBLENBQWNDLE9BQUEsQyxXQUFBLENBQXBCLENBQ0EsTUFBTUMsbUJBQUEsQ0FBc0JELE9BQUEsQyxtQkFBQSxDQUE1QixDQUNBLE1BQU1FLE1BQUEsQ0FBU0YsT0FBQSxDLG1CQUFBLENBQWYsQ0FDQSxNQUFNRyxNQUFBLENBQVNILE9BQUEsQyxtQkFBQSxDQUFmLENBQ0FJLE1BQUEsQyxrQkFBQSxFQUFpQixNQUFNQywwQkFBTixTQUF5Q04sV0FBQSxDLG1CQUFBLENBQXFCLENBQzNFTyxXQUFBLEVBQWMsQ0FDVixNLG1CQUFBLENBQTRCLEMsTUFDeEIsQ0FBTVAsV0FBQSxDLFdBQUEsRSxtQkFBQSxFLElBQUEsQ0FEa0IsQ0FBNUIsRUFHQSxLLG1CQUFBLEVBQXlCLE1B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XG4gKiBAYXV0aG9yIFNhbmthcnNhbiBLYW1wYSAoazNybjMxcDRuaWMpXG4gKiBAY29weXJpZ2h0IDIwMjAgLSBUaGUgQmFzdGlvbiBCb3QgUHJvamVjdFxuICovXG5jb25zdCB0ZXNzZXJhY3RfMSA9IHJlcXVpcmUoXCJ0ZXNzZXJhY3RcIik7XG5jb25zdCBSZWFjdGlvblJvbGVHcm91cF8xID0gcmVxdWlyZShcIi4uL21vZGVscy9SZWFjdGlvblJvbGVHcm91cFwiKTtcbmNvbnN0IFJvbGVfMSA9IHJlcXVpcmUoXCIuLi9tb2RlbHMvUm9sZVwiKTtcbmNvbnN0IGVtb2ppcyA9IHJlcXVpcmUoXCIuLi91dGlscy9lbW9qaXNcIik7XG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIE1lc3NhZ2VSZWFjdGlvbkFkZExpc3RlbmVyIGV4dGVuZHMgdGVzc2VyYWN0XzEuTGlzdGVuZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihcIm1lc3NhZ2VSZWFjdGlvbkFkZFwiLCB7XG4gICAgICAgICAgICBtb2RlOiB0ZXNzZXJhY3RfMS5Db25zdGFudHMuTElTVEVORVJfTU9ERS5PTixcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaGFuZGxlU3VnZ2VzdGlvbnMgPSBhc3luYyAobWVzc2FnZVJlYWN0aW9uLCBtZW1iZXIpID0+IHtcbiAgICAgICAgICAgIGlmICghW1wi4pyFXCIsIFwi4p2OXCJdLmluY2x1ZGVzKG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5uYW1lKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmNoYW5uZWwucGVybWlzc2lvbnNGb3IobWVtYmVyKS5oYXMoXCJNQU5BR0VfQ0hBTk5FTFNcIikpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbk1lc3NhZ2UgPSBtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZTtcbiAgICAgICAgICAgIGNvbnN0IHN1Z2dlc3Rpb25FbWJlZCA9IHN1Z2dlc3Rpb25NZXNzYWdlLmVtYmVkc1swXTtcbiAgICAgICAgICAgIGlmICghc3VnZ2VzdGlvbkVtYmVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmICghc3VnZ2VzdGlvbkVtYmVkLnRpdGxlLnN0YXJ0c1dpdGgoXCJTdWdnZXN0aW9uXCIpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHN1Z2dlc3Rpb25FbWJlZC5jb2xvciA9IG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5uYW1lID09PSBcIuKchVwiID8gdGVzc2VyYWN0XzEuQ29uc3RhbnRzLkNPTE9SUy5HUkVFTiA6IG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5uYW1lID09PSBcIuKdjlwiID8gdGVzc2VyYWN0XzEuQ29uc3RhbnRzLkNPTE9SUy5SRUQgOiB0ZXNzZXJhY3RfMS5Db25zdGFudHMuQ09MT1JTLklORElHTztcbiAgICAgICAgICAgIHN1Z2dlc3Rpb25FbWJlZC50aXRsZSA9IFwiU3VnZ2VzdGlvbiBcIiArIChtZXNzYWdlUmVhY3Rpb24uZW1vamkubmFtZSA9PT0gXCLinIVcIiA/IFwiQWNjZXB0ZWRcIiA6IG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5uYW1lID09PSBcIuKdjlwiID8gXCJSZWplY3RlZFwiIDogXCJcIik7XG4gICAgICAgICAgICBhd2FpdCBzdWdnZXN0aW9uTWVzc2FnZS5lZGl0KHtcbiAgICAgICAgICAgICAgICBlbWJlZDogc3VnZ2VzdGlvbkVtYmVkLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlU3RhcmJvYXJkID0gYXN5bmMgKG1lc3NhZ2VSZWFjdGlvbiwgbWVtYmVyLCBzdGFyYm9hcmRDaGFubmVsKSA9PiB7XG4gICAgICAgICAgICBpZiAoIVtcIvCfjKBcIiwgXCLwn4yfXCIsIFwi4q2QXCJdLmluY2x1ZGVzKG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5uYW1lKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAobWVtYmVyLnJvbGVzLmNhY2hlLnNpemUgPD0gMSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAobWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuYXV0aG9yLmlkID09PSBtZW1iZXIudXNlci5pZClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBpbWFnZUF0dGFjaG1lbnRzID0gbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuYXR0YWNobWVudHMuZmlsdGVyKGEgPT4gQm9vbGVhbihhLmhlaWdodCAmJiBhLndpZHRoKSk7XG4gICAgICAgICAgICBjb25zdCBpbWFnZUF0dGFjaG1lbnQgPSBpbWFnZUF0dGFjaG1lbnRzLmZpcnN0KCk7XG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmNvbnRlbnQgJiYgIWltYWdlQXR0YWNobWVudClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBhd2FpdCBzdGFyYm9hcmRDaGFubmVsLnNlbmQoe1xuICAgICAgICAgICAgICAgIGVtYmVkOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0ZXNzZXJhY3RfMS5Db25zdGFudHMuQ09MT1JTLllFTExPVyxcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZS5hdXRob3IudGFnLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvblVSTDogbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuYXV0aG9yLmRpc3BsYXlBdmF0YXJVUkwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5bmFtaWM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogNjQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkczogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiU291cmNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwiW0NsaWNrIGhlcmUgdG8gSnVtcCB0byB0aGUgTWVzc2FnZS5dKFwiICsgbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UudXJsICsgXCIpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5saW5lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogaW1hZ2VBdHRhY2htZW50ID8gaW1hZ2VBdHRhY2htZW50LnVybCA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGZvb3Rlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJTdGFyYm9hcmRcIixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlUmVhY3Rpb25Bbm5vdW5jZW1lbnQgPSBhc3luYyAobWVzc2FnZVJlYWN0aW9uLCBtZW1iZXIsIGFubm91bmNlbWVudENoYW5uZWwpID0+IHtcbiAgICAgICAgICAgIGlmICghW1wi8J+To1wiLCBcIvCfk6JcIl0uaW5jbHVkZXMobWVzc2FnZVJlYWN0aW9uLmVtb2ppLm5hbWUpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmICghbWVtYmVyLnBlcm1pc3Npb25zLmhhcyhcIk1BTkFHRV9HVUlMRFwiKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBmb290ZXJNZXNzYWdlID0gbWVtYmVyLnVzZXIudGFnICsgXCIgYW5ub3VuY2VkIHZpYSBBbm5vdW5jZW1lbnQgUGlubm5pbmcuXCI7XG4gICAgICAgICAgICBjb25zdCBlbWJlZCA9IG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmVtYmVkcyAmJiBtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZS5lbWJlZHMubGVuZ3RoID8gbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuZW1iZWRzWzBdIDoge307XG4gICAgICAgICAgICBlbWJlZC5mb290ZXIgPSB7XG4gICAgICAgICAgICAgICAgLi4uZW1iZWQuZm9vdGVyLFxuICAgICAgICAgICAgICAgIHRleHQ6IGVtYmVkLmZvb3RlciAmJiBlbWJlZC5mb290ZXIudGV4dCA/IGZvb3Rlck1lc3NhZ2UgKyBcIiDigKIgXCIgKyBlbWJlZC5mb290ZXIudGV4dCA6IGZvb3Rlck1lc3NhZ2UsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgYW5ub3VuY2VtZW50Q2hhbm5lbC5zZW5kKG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmNvbnRlbnQsIHtcbiAgICAgICAgICAgICAgICBlbWJlZCxcbiAgICAgICAgICAgICAgICBmaWxlczogWy4uLm1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmF0dGFjaG1lbnRzLnZhbHVlcygpXSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVJlYWN0aW9uUGlubmluZyA9IGFzeW5jIChtZXNzYWdlUmVhY3Rpb24sIG1lbWJlcikgPT4ge1xuICAgICAgICAgICAgaWYgKCFbXCLwn5OMXCIsIFwi8J+TjVwiXS5pbmNsdWRlcyhtZXNzYWdlUmVhY3Rpb24uZW1vamkubmFtZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKCFtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZS5jaGFubmVsLnBlcm1pc3Npb25zRm9yKG1lbWJlcikuaGFzKFwiTUFOQUdFX01FU1NBR0VTXCIpKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGF3YWl0IG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLnBpbigpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmhhbmRsZVJlYWN0aW9uUm9sZXMgPSBhc3luYyAobWVzc2FnZVJlYWN0aW9uLCBtZW1iZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlYWN0aW9uUm9sZXNHcm91cCA9IGF3YWl0IFJlYWN0aW9uUm9sZUdyb3VwXzEuZGVmYXVsdC5maW5kQnlJZChtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZS5pZCk7XG4gICAgICAgICAgICBpZiAoIXJlYWN0aW9uUm9sZXNHcm91cClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBlbW9qaSA9IG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5pZFxuICAgICAgICAgICAgICAgID8gXCI8XCIgKyAobWVzc2FnZVJlYWN0aW9uLmVtb2ppLmFuaW1hdGVkID8gXCJhXCIgOiBcIlwiKSArIFwiOlwiICsgbWVzc2FnZVJlYWN0aW9uLmVtb2ppLm5hbWUgKyBcIjpcIiArIG1lc3NhZ2VSZWFjdGlvbi5lbW9qaS5pZCArIFwiPlwiXG4gICAgICAgICAgICAgICAgOiBtZXNzYWdlUmVhY3Rpb24uZW1vamkubmFtZTtcbiAgICAgICAgICAgIGNvbnN0IGVtb2ppT2JqZWN0ID0gZW1vamlzLnBhcnNlRW1vamkoZW1vamkpO1xuICAgICAgICAgICAgaWYgKGVtb2ppT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVhY3Rpb25Sb2xlID0gYXdhaXQgUm9sZV8xLmRlZmF1bHQuZmluZE9uZSh7XG4gICAgICAgICAgICAgICAgICAgICRvcjogcmVhY3Rpb25Sb2xlc0dyb3VwLnJvbGVzLm1hcChpZCA9PiAoeyBfaWQ6IGlkIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgZ3VpbGQ6IG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmd1aWxkLmlkLFxuICAgICAgICAgICAgICAgICAgICBlbW9qaTogZW1vamlPYmplY3QudmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZWFjdGlvblJvbGUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAocmVhY3Rpb25Sb2xlc0dyb3VwLmV4Y2x1c2l2ZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHJlYWN0aW9uIG9mIG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLnJlYWN0aW9ucy5jYWNoZS5maWx0ZXIociA9PiByLnVzZXJzLmNhY2hlLmhhcyhtZW1iZXIudXNlci5pZCkgJiYgci5lbW9qaS5uYW1lICE9PSBtZXNzYWdlUmVhY3Rpb24uZW1vamkubmFtZSkudmFsdWVzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJlYWN0aW9uLnVzZXJzLnJlbW92ZShtZW1iZXIpLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yb2xlcy5yZW1vdmUocmVhY3Rpb25Sb2xlc0dyb3VwLnJvbGVzLCBcIkF1dG8gUmVtb3ZlZCB2aWEgUmVhY3Rpb24gUm9sZXNcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF3YWl0IG1lbWJlci5yb2xlcy5hZGQocmVhY3Rpb25Sb2xlLl9pZCwgXCJBZGRlZCB2aWEgUmVhY3Rpb24gUm9sZXNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZXhlYyA9IGFzeW5jIChtZXNzYWdlUmVhY3Rpb24sIHVzZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChtZXNzYWdlUmVhY3Rpb24ucGFydGlhbCkge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2VSZWFjdGlvbiA9IGF3YWl0IG1lc3NhZ2VSZWFjdGlvbi5mZXRjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLnBhcnRpYWwpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZSA9IGF3YWl0IG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmZldGNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmd1aWxkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IG1lbWJlciA9IG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmd1aWxkLm1lbWJlcih1c2VyKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVhY3Rpb25Sb2xlcyhtZXNzYWdlUmVhY3Rpb24sIG1lbWJlcikuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBndWlsZERvY3VtZW50ID0gYXdhaXQgbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuZ3VpbGQuZ2V0RG9jdW1lbnQoKTtcbiAgICAgICAgICAgIGlmIChndWlsZERvY3VtZW50LnN1Z2dlc3Rpb25zQ2hhbm5lbElkICYmIG1lc3NhZ2VSZWFjdGlvbi5tZXNzYWdlLmNoYW5uZWwuaWQgPT09IGd1aWxkRG9jdW1lbnQuc3VnZ2VzdGlvbnNDaGFubmVsSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVN1Z2dlc3Rpb25zKG1lc3NhZ2VSZWFjdGlvbiwgbWVtYmVyKS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3VpbGREb2N1bWVudC5zdGFyYm9hcmRDaGFubmVsSWQgJiYgbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuZ3VpbGQuY2hhbm5lbHMuY2FjaGUuaGFzKGd1aWxkRG9jdW1lbnQuc3RhcmJvYXJkQ2hhbm5lbElkKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhcmJvYXJkKG1lc3NhZ2VSZWFjdGlvbiwgbWVtYmVyLCBtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZS5ndWlsZC5jaGFubmVscy5jYWNoZS5nZXQoZ3VpbGREb2N1bWVudC5zdGFyYm9hcmRDaGFubmVsSWQpKS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3VpbGREb2N1bWVudC5yZWFjdGlvbkFubm91bmNlbWVudHMgJiYgbWVzc2FnZVJlYWN0aW9uLm1lc3NhZ2UuZ3VpbGQuY2hhbm5lbHMuY2FjaGUuaGFzKGd1aWxkRG9jdW1lbnQuYW5ub3VuY2VtZW50c0NoYW5uZWxJZCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlYWN0aW9uQW5ub3VuY2VtZW50KG1lc3NhZ2VSZWFjdGlvbiwgbWVtYmVyLCBtZXNzYWdlUmVhY3Rpb24ubWVzc2FnZS5ndWlsZC5jaGFubmVscy5jYWNoZS5nZXQoZ3VpbGREb2N1bWVudC5hbm5vdW5jZW1lbnRzQ2hhbm5lbElkKSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGd1aWxkRG9jdW1lbnQucmVhY3Rpb25QaW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZWFjdGlvblBpbm5pbmcobWVzc2FnZVJlYWN0aW9uLCBtZW1iZXIpLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG59OyJdfQ==